"use strict";(self.webpackChunkstarcoin_cookbook=self.webpackChunkstarcoin_cookbook||[]).push([[6012],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return m}});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var p=a.createContext({}),l=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=l(e.components);return a.createElement(p.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,p=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),h=l(n),m=o,u=h["".concat(p,".").concat(m)]||h[m]||d[m]||r;return n?a.createElement(u,i(i({ref:t},c),{},{components:n})):a.createElement(u,i({ref:t},c))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=h;var s={};for(var p in t)hasOwnProperty.call(t,p)&&(s[p]=t[p]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var l=2;l<r;l++)i[l]=n[l];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},8120:function(e,t,n){n.r(t),n.d(t,{assets:function(){return c},contentTitle:function(){return p},default:function(){return m},frontMatter:function(){return s},metadata:function(){return l},toc:function(){return d}});var a=n(7462),o=n(3366),r=(n(7294),n(3905)),i=["components"],s={},p="How to sync the block and state faster",l={unversionedId:"getting-started/setup/fast-sync-data",id:"getting-started/setup/fast-sync-data",title:"How to sync the block and state faster",description:"Usually, starting a new main network node will automatically synchronize block data, and this process is very long.",source:"@site/docs/02-getting-started/02-setup/05-fast-sync-data.md",sourceDirName:"02-getting-started/02-setup",slug:"/getting-started/setup/fast-sync-data",permalink:"/starcoin-cookbook/docs/getting-started/setup/fast-sync-data",editUrl:"https://github.com/starcoinorg/starcoin-cookbook/edit/main/docs/02-getting-started/02-setup/05-fast-sync-data.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"How to participate in a test network",permalink:"/starcoin-cookbook/docs/getting-started/setup/test-network"},next:{title:"How to participate in the main network",permalink:"/starcoin-cookbook/docs/getting-started/setup/main-network"}},c={},d=[{value:"Download and install",id:"download-and-install",level:2},{value:"Sync block data",id:"sync-block-data",level:2},{value:"Export block",id:"export-block",level:3},{value:"Import block",id:"import-block",level:3},{value:"Import block data using script (recommended)",id:"import-block-data-using-script-recommended",level:3},{value:"Status of the sync chain",id:"status-of-the-sync-chain",level:2},{value:"Export snapshot",id:"export-snapshot",level:3},{value:"Import snapshot",id:"import-snapshot",level:3},{value:"Import snapshots using a script",id:"import-snapshots-using-a-script",level:3}],h={toc:d};function m(e){var t=e.components,n=(0,o.Z)(e,i);return(0,r.kt)("wrapper",(0,a.Z)({},h,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"how-to-sync-the-block-and-state-faster"},"How to sync the block and state faster"),(0,r.kt)("p",null,"Usually, starting a new main network node will automatically synchronize block data, and this process is very long."),(0,r.kt)("p",null,"Next, we will introduce how to use the data export tool provided by the Starcoin toolchains to speed up the speed of new nodes synchronizing block data, and how to synchronize the state of the chain."),(0,r.kt)("h2",{id:"download-and-install"},"Download and install"),(0,r.kt)("p",null,"Download the corresponding precompiled ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/starcoinorg/starcoin/releases"},"Starcoin toolchains")," according to the system you are using.\nIf you have already ",(0,r.kt)("a",{parentName:"p",href:"https://starcoinorg.github.io/starcoin-cookbook/docs/getting-started/install/"},"downloaded and installed")," ",(0,r.kt)("inlineCode",{parentName:"p"},"starcoin"),", you can skip this step."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"# Take Ubuntu as an example\nwget https://github.com/starcoinorg/starcoin/releases/download/v1.11.10/starcoin-ubuntu-latest.zip\n\n# Unzip\nunzip starcoin-ubuntu-latest.zip\n\n# Enter the decompression directory and check\ncd starcoin-artifacts/\n./starcoin_db_exporter -h\n")),(0,r.kt)("p",null,"Tip: If you use it frequently, it is recommended to add it to the PATH environment variable."),(0,r.kt)("h2",{id:"sync-block-data"},"Sync block data"),(0,r.kt)("p",null,"If a new full node is started, it is usually to download the main network block data of other nodes to the new node, and start the node with the downloaded block data.\nDownloaded (exported) block data is stored on a CSV file for easy data exchange and storage."),(0,r.kt)("h3",{id:"export-block"},"Export block"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"export-block-range")," subcommand is used to export block data."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"# Create a directory to store the block data exported from the node\nmkdir ~/bak\n\n# export block\n./starcoin_db_exporter export-block-range -i ~/.starcoin/main/ -s 1 -e 10000 -n main -o ~/bak\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"-i")," Specifies the data directory for the node."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"-s")," Specifies the starting height of block data."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"-e")," Specifies the end height of the block data."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"-n")," Specifies the network."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"-o")," Specifies the directory to store the exported data.")),(0,r.kt)("p",null,"After the export, you can see that the export file is ",(0,r.kt)("inlineCode",{parentName:"p"},"~/bak/block_1_10000.csv")," in the ",(0,r.kt)("inlineCode",{parentName:"p"},"~/bak")," directory."),(0,r.kt)("h3",{id:"import-block"},"Import block"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"apply-block")," subcommand is used to import block data."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"./starcoin_db_exporter apply-block -i block_1_10000.csv -n main -o ~/.starcoin/main/\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"-i")," Specifies the path to the CSV file to import block data."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"-n")," Specifies the network."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"-o")," Specifies the data directory for the node.")),(0,r.kt)("h3",{id:"import-block-data-using-script-recommended"},"Import block data using script (recommended)"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"import_block.sh")," script is provided in the ",(0,r.kt)("inlineCode",{parentName:"p"},"starcoin")," repository, and the precompiled version is also packaged with the corresponding script.\nIt is more convenient to import block data using a script instead of having to export and import manually."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"./import_block.sh main ~/.starcoin/main\n")),(0,r.kt)("p",null,"This script accepts two parameters, parameter 1 specifies the network name, such as ",(0,r.kt)("inlineCode",{parentName:"p"},"main"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"barnard"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"proxima")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"halley"),", and parameter 2 specifies the directory where the data is stored, such as ",(0,r.kt)("inlineCode",{parentName:"p"},"~/.starcoin/main")," or any custom path.\nThis script will skip the existing blocks, and each time a block is acquired, the progress will be automatically updated.\nAfter the script is interrupted and executed, the import will continue at the original height."),(0,r.kt)("p",null,"After executing the script, the mainnet block data will be automatically downloaded to the ",(0,r.kt)("inlineCode",{parentName:"p"},"~/.starcoin/main")," directory and imported.\nWait for the download and import to complete, then you can run a new node with these block data."),(0,r.kt)("p",null,"Note: To use this script, make sure ",(0,r.kt)("inlineCode",{parentName:"p"},"starcoin_db_exporter")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"import_block.sh")," are in the same path."),(0,r.kt)("h2",{id:"status-of-the-sync-chain"},"Status of the sync chain"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"starcoin_db_exporter")," command provides a snapshot function of offline export and import of ",(0,r.kt)("inlineCode",{parentName:"p"},"main"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"barnard"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"proxima"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"halley")," networks, which is convenient to quickly build a blockchain network."),(0,r.kt)("h3",{id:"export-snapshot"},"Export snapshot"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"export-snapshot")," subcommand is used to export snapshots."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Normal export:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"# Create a directory for storing snapshot data exported from the node\nmkdir ~/snapshot\n\n# Export snapshot\n./starcoin_db_exporter export-snapshot -i ~/.starcoin/main -n main -o ~/snapshot\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"-i")," Specifies the data directory for the node."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"-n")," Specifies the network."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"-o")," Specifies the directory where the exported snapshots are stored.")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Incremental export:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"./starcoin_db_exporter export-snapshot -i ~/.starcoin/main -n main -o ~/snapshot -t true\n")),(0,r.kt)("p",null,"Use the ",(0,r.kt)("inlineCode",{parentName:"p"},"-t")," option to specify whether to use incremental export, ",(0,r.kt)("inlineCode",{parentName:"p"},"true")," to enable, ",(0,r.kt)("inlineCode",{parentName:"p"},"false")," to disable.\nIf you want to use incremental export, you need to ensure that there are old snapshots in the ",(0,r.kt)("inlineCode",{parentName:"p"},"~/snapshot")," directory.\nFor example, the original snapshot height in the ",(0,r.kt)("inlineCode",{parentName:"p"},"~/snapshot")," directory is ",(0,r.kt)("inlineCode",{parentName:"p"},"1-400w"),", and now you need to export snapshots with a height of ",(0,r.kt)("inlineCode",{parentName:"p"},"1-500w"),".\nIf incremental export is used, the subsequent ",(0,r.kt)("inlineCode",{parentName:"p"},"400w-500w")," snapshots will be exported first, and then merged with the original snapshots to save time."),(0,r.kt)("h3",{id:"import-snapshot"},"Import snapshot"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"apply-snapshot")," subcommand is used to import snapshots."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"./starcoin_db_exporter apply-snapshot -i ~/snapshot -n main -o ~/.starcoin/main\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"-i")," Specifies the directory where snapshots are stored."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"-n")," Specifies the network."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"-o")," Specifies the data directory for the node.")),(0,r.kt)("h3",{id:"import-snapshots-using-a-script"},"Import snapshots using a script"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"import_snapshot.sh")," script is provided in the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/starcoinorg/starcoin/blob/master/scripts/import_snapshot.sh"},(0,r.kt)("inlineCode",{parentName:"a"},"starcoin"))," repository, and the precompiled version is also packaged with the corresponding script."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"./import_snapshot.sh main ~/snapshot/ ~/.starcoin/main\n")),(0,r.kt)("p",null,"This script needs to pass 3 parameters, parameter 1 specifies the name of the network, parameter 2 specifies the storage path of the snapshot, and parameter 3 specifies the data directory of the node."),(0,r.kt)("p",null,"Note: To use this script, make sure ",(0,r.kt)("inlineCode",{parentName:"p"},"starcoin_db_exporter")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"import_snapshot.sh")," are in the same path."))}m.isMDXComponent=!0}}]);