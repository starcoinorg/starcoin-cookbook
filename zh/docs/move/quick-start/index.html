<!doctype html>
<html lang="zh-CN" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-move/quick-start">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.22">
<title data-rh="true">快速开始 | Starcoin Cookbook</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://starcoinorg.github.io/zh/docs/move/quick-start"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="快速开始 | Starcoin Cookbook"><meta data-rh="true" name="description" content="在这个教程中，我们将实现一个简单的计数器，来展示 Move 是如何通过代码来管理资源的。"><meta data-rh="true" property="og:description" content="在这个教程中，我们将实现一个简单的计数器，来展示 Move 是如何通过代码来管理资源的。"><link data-rh="true" rel="icon" href="/zh/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://starcoinorg.github.io/zh/docs/move/quick-start"><link data-rh="true" rel="alternate" href="https://starcoinorg.github.io/docs/move/quick-start" hreflang="en-US"><link data-rh="true" rel="alternate" href="https://starcoinorg.github.io/zh/docs/move/quick-start" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://starcoinorg.github.io/docs/move/quick-start" hreflang="x-default"><link rel="stylesheet" href="/zh/assets/css/styles.bd80adfe.css">
<link rel="preload" href="/zh/assets/js/runtime~main.dce544f6.js" as="script">
<link rel="preload" href="/zh/assets/js/main.4328e06e.js" as="script">
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">跳到主要内容</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh/"><div class="navbar__logo"><img src="/zh/img/logo.svg" alt="Starcoin Cookbook" class="themedImage_ToTc themedImage--light_HNdA"><img src="/zh/img/logo.svg" alt="Starcoin Cookbook" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Starcoin Cookbook</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zh/docs/intro">Documents</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>中文</a><ul class="dropdown__menu"><li><a href="/docs/move/quick-start" target="_self" rel="noopener noreferrer" class="dropdown__link">English</a></li><li><a href="/zh/docs/move/quick-start" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active">中文</a></li></ul></div><a href="https://github.com/starcoinorg/starcoin-cookbook" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/docs/intro">Starcoin CookBook 介绍</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/docs/getting-started/install/">新手入门</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/zh/docs/move/">Move 和智能合约开发</a><button aria-label="打开/收起侧边栏菜单「Move 和智能合约开发」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/move/prepare-move-env">设置 Move 开发环境</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/zh/docs/move/quick-start">快速开始</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zh/docs/move/move-language/">Move 语言</a><button aria-label="打开/收起侧边栏菜单「Move 语言」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/move/understanding-ability">认识 Ability</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/move/move-package-manager">Move 包管理器用户指南</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zh/docs/move/starcoin-framework/">Starcoin Move Framework</a><button aria-label="打开/收起侧边栏菜单「Starcoin Move Framework」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/move/deploy-first-move-contract">如何部署 Move 智能合约</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/move/interacting-with-the-contract">与合约交互</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/move/module-dependency">Understanding module dependency</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/move/how-to-upgrade">How to upgrade Move Module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/move/for-solidity-developer">For solidity developer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/move/call-function">如何调用函数</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zh/docs/move/move-vm/">Move VM 原理分析</a><button aria-label="打开/收起侧边栏菜单「Move VM 原理分析」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zh/docs/move/move-test/">如何测试 Move Module</a><button aria-label="打开/收起侧边栏菜单「如何测试 Move Module」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zh/docs/move/move-examples/">更多 Move 例子</a><button aria-label="打开/收起侧边栏菜单「更多 Move 例子」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zh/docs/move/advance-move/">Move 高级开发</a><button aria-label="打开/收起侧边栏菜单「Move 高级开发」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zh/docs/move/move-prover/">Move 规范语言和 Move Prover</a><button aria-label="打开/收起侧边栏菜单「Move 规范语言和 Move Prover」" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/zh/docs/web3/">Web3 和 DApp 开发</a><button aria-label="打开/收起侧边栏菜单「Web3 和 DApp 开发」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/zh/docs/reference/">参考</a><button aria-label="打开/收起侧边栏菜单「参考」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/zh/docs/concepts/">概念</a><button aria-label="打开/收起侧边栏菜单「概念」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/docs/miscellaneous/contributing">杂项</a></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/zh/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/zh/docs/move/"><span itemprop="name">Move 和智能合约开发</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">快速开始</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>快速开始</h1><p>在这个教程中，我们将实现一个简单的计数器，来展示 Move 是如何通过代码来管理资源的。
这篇文档涉及的内容包括背景知识、写代码、如何编译、如何发布到链上、如何调用。
完整的代码仓库在<a href="https://github.com/starcoinorg/starcoin-cookbook/tree/main/examples/my-counter" target="_blank" rel="noopener noreferrer">这里</a>。</p><p>提前准备：</p><ol><li>需要按照<a href="/zh/docs/getting-started/setup/dev-network">如何设置本地开发网络</a>搭建 <em>dev</em> 网络，并通过 Starcoin 控制台连接到 <em>dev</em> 网络。</li><li>按照<a href="/zh/docs/getting-started/accounts/account-manage">账号管理</a>创建一个账号或者使用已有账号，并且给账号里转一点 STC。</li><li>通过<a href="/zh/docs/getting-started/accounts/first-transaction">第一笔链上交易</a>对<em>交易</em>有基本的理解。</li></ol><p>接下来将介绍一些必备工具和项目结构。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="mpm-命令行工具以及项目结构">mpm 命令行工具以及项目结构<a class="hash-link" href="#mpm-命令行工具以及项目结构" title="标题的直接链接">​</a></h2><p>在开始写代码之前，我们先安装 <code>mpm</code>（Move Package Manager）命令行工具，并且简单介绍一下 Move 项目的结构。</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>mpm 简介</div><div class="admonitionContent_S0QG"><p><code>mpm</code> 是由 Starcoin 开发者在 <code>move-cli</code> 的基础上封装并集成了一些额外的功能，方便开发、测试、部署 Starcoin 智能合约。</p></div></div><p>安装方法见<a href="/zh/docs/move/prepare-move-env">设置 Move 开发环境</a>.</p><p>现在，可以通过 <code>mpm</code> 创建一个新项目：</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ mpm package new my-counter</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>可以看到生成的目录结构：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">my-counter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── Move.toml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── sources</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><em>sources</em> - 存放 Move 模块（module）的目录。</li><li><em>Move.toml</em> - 清单（manifest）文件：定义包的元数据、依赖以及命名地址。</li></ul><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Move 模块</div><div class="admonitionContent_S0QG"><p>模块是定义<strong>结构体类型</strong>和操作结构体的<strong>函数</strong>的库。<em>（可以借助其他编程语言“类（class）”的概念来帮助理解）</em>。</p><p>模块会被发布到发布者的地址下，模块中的<em>入口方法（entry functions）</em>可以被大家调用执行。
<em>（可以借助函数计算平台 —— 如 AWS Lambda —— 上发布函数、调用函数来帮助理解）</em></p></div></div><p>由 <em>Move.toml</em> 文件和 <em>sources</em> 目录组成的项目，会被认为是一个 <a href="/zh/docs/move/move-language/packages">Move 包（Move Package）</a>。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="创建-mycounter-模块">创建 MyCounter 模块<a class="hash-link" href="#创建-mycounter-模块" title="标题的直接链接">​</a></h2><p>在 <em>sources</em> 目录下创建一个 <em>MyCounter.move</em> 文件用来存放模块的代码。</p><p>我们将要创建的模块命名为 <code>MyCounter</code>，在本文中，使用笔者本地 <em>dev</em> 网络的一个账户地址 <code>0xcada49d6a37864931afb639203501695</code> 来演示，我们会将 <code>MyCounter</code> 模块发布到这个地址上。</p><p>定义模块的语法：</p><div class="language-move codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-move codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">module &lt;address&gt;::&lt;identifier&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // module body</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="第一版代码">第一版代码<a class="hash-link" href="#第一版代码" title="标题的直接链接">​</a></h3><p>在 <code>MyCounter</code> 模块中，我们定义一个结构体 <code>Counter</code>，包含有一个字段 <code>value</code>，代表这个计数器触发的次数。
<code>value</code> 的类型是 <code>u64</code>，也就是无符号64位整型。</p><p>下面是 <code>MyCounter</code> 模块的第一版代码：</p><div class="language-move codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">my-counter/sources/MyCounter.move</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-move codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">module 0xcada49d6a37864931afb639203501695::MyCounter {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct Counter {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        value: u64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们可以使用 <code>mpm package build</code> 这条命令来构建我们的计数器程序。</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ mpm package build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BUILDING my-counter</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>可以看到，程序顺利通过了编译，接着往下走。</p><p>由于这个地址太长，可以在 <em>Move.toml</em> 文件中设置一个<em>命名地址（named address）</em>，它可以做到在 Move 项目中全局替换。</p><div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">my-counter/Move.toml</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[package]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">name = &quot;my-counter&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">version = &quot;0.0.1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">[addresses]</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">MyCounterAddr = &quot;0xcada49d6a37864931afb639203501695&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>提示</div><div class="admonitionContent_S0QG"><p>高亮的代码块是有变化的或是需要注意的部分。</p></div></div><p>这样，第一版代码可以写为：</p><div class="language-move codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">my-counter/sources/MyCounter.move</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-move codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">module MyCounterAddr::MyCounter {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct Counter {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        value: u64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>MyCounterAddr</code> 是命名地址，<code>MyCounter</code> 是模块标识符。</p><p>接着我们编译代码：</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ mpm package build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BUILDING my-counter</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>没有报错，说明没有问题。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="初始化方法-init">初始化方法 init<a class="hash-link" href="#初始化方法-init" title="标题的直接链接">​</a></h3><p>接着我们定一个初始化方法，用来创建一个 <code>Counter</code> 实例，并<em>“移动（move）”</em>到调用者账户的存储空间下。</p><div class="language-move codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">my-counter/sources/MyCounter.move</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-move codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">module MyCounterAddr::MyCounter {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct Counter {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        value: u64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    public fun init(account: &amp;signer) {</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        move_to(account, Counter { value: 0 });</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这里的 <code>move_to&lt;T&gt;(&amp;signer, T)</code> 是一个内置方法，作用是将类型为 <code>T</code> 的资源添加到账户 <code>signer</code> 的地址下的存储空间（尖括号在这里表示泛型）。</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>更多信息</div><div class="admonitionContent_S0QG"><p>这里的存储空间是 <code>GlobalState</code>，可以先简单理解为存放账户的<em>资源</em>和<em>模块代码</em>的地方。
更多详细信息可以查阅<a href="/zh/docs/concepts/state">概念-状态</a>。</p></div></div><p>在第6行的 <code>init</code> 函数的参数 <code>account: &amp;signer</code> 中的 <code>signer</code> 是 Move 的内置类型。
想要将资源放到调用者的账户地址下，需要将 <code>&amp;signer</code> 参数传递给函数。
<code>&amp;signer</code> 数据类型代表当前交易的发起者（函数的调用者，可以是任何账户）。</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>帮你理解 —— signer</div><div class="admonitionContent_S0QG"><p><code>signer</code> 就像是 Linux 下的 <em>uid</em> 一样的东西。登陆 Linux 系统后，你输入的所有命令，都被认为是“这个已登陆的<strong>经过认证</strong>的用户”操作的。
关键来了，这个认证过程不是在运行的命令、程序中做的，而是开机后由操作系统完成的。</p><p>对应到 Move 中，这个认证过程就是和其他区块链系统类似的、我们熟知的“私钥签名，公钥验证”的过程。
在带有 <code>&amp;signer</code> 参数的函数执行时，发起者的身份已经被 Starcoin 区块链认证过了。</p></div></div><p>我们试着编译一下：</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ mpm package build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BUILDING my-counter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">error</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">E05001</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">: ability constraint not satisfied</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ┌─ ./sources/MyCounter.move:7:6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> │     struct Counter </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │            ------- To satisfy the constraint, the </span><span class="token string" style="color:#e3116c">&#x27;key&#x27;</span><span class="token plain"> ability would need to be added here</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ·</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">7</span><span class="token plain"> │         move_to</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">account, Counter </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> value: </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │         │                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │         │                The </span><span class="token builtin class-name">type</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;MyCounterAddr::MyCounter::Counter&#x27;</span><span class="token plain"> does not have the ability </span><span class="token string" style="color:#e3116c">&#x27;key&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │         Invalid call of </span><span class="token string" style="color:#e3116c">&#x27;move_to&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>出错了！提示我们 “ability constraint not satisfied”，下面还有一句 “The type &#x27;MyCounterAddr::MyCounter::Counter&#x27; does not have the ability &#x27;key&#x27;”。
编译器告诉我们 <code>MyCounterAddr::MyCounter::Counter</code> 这个资源类型缺少 <code>key</code> <em>能力（ability）</em>，所以不能用 <code>move_to</code> 添加到账户地址下。</p><p>这里涉及到了 Move 的<em>能力</em>特性。</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>概念 —— ability</div><div class="admonitionContent_S0QG"><p>Move语言是面向资源的语言，核心是资源的管理。
针对资源拥有什么“<strong>能力</strong>”，Move 编程语言抽象了资源的四个属性 —— 可复制（copy)、可索引（key）、可丢弃（drop）、可储存（store）。
通过这四个属性的不同组合，用户可以方便的定义出任何能力的资源。
比如用户可以通过 <code>key + copy + drop + store</code> 的组合定义出一个普通的信息类型，通过 <code>key + store</code> 的组合定义出一个资产类型 —— 例如 NFT —— 没有 <code>copy</code> 属性可以保证 NFT 不能被随意的复制，提升了安全性。</p><p>Move 提供的四种能力：</p><ul><li>copy：表示该值是否可以被复制</li><li>drop：表示该值是否可以在作用域结束时可以被丢弃</li><li>key：表示该值是否可以作为全局状态的键进行访问</li><li>store：表示该值是否可以被存储到全局状态</li></ul><p>通过给资源赋予不同的能力，Move 虚拟机可以从根本上保证「资源」只能<em>转移（move）</em>，至于能否拷贝、修改、丢弃，需要看资源的具体能力。
如果强行拷贝、修改或者丢弃，代码编译会出错，根本没有机会运行。</p><p>更多信息可以参考：<a href="/zh/docs/move/understanding-ability">认识 Ability</a> 章节。</p></div></div><p>一般来说我们认为，<strong>有 <code>key</code> 能力的结构体，就是资源</strong>。</p><p>我们修改代码，按照提示添加 <code>key</code> 能力。</p><div class="language-move codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">my-counter/sources/MyCounter.move</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-move codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">module MyCounterAddr::MyCounter {</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    struct Counter has key {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        value: u64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public fun init(account: &amp;signer) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        move_to(account, Counter { value: 0 });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>此时再次编译可以通过。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="计数器加一的方法-incr">计数器加一的方法 incr<a class="hash-link" href="#计数器加一的方法-incr" title="标题的直接链接">​</a></h3><p>现在给 <code>Counter</code> 资源添加一个 <code>incr</code> 方法。</p><div class="language-move codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">my-counter/sources/MyCounter.move</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-move codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">module MyCounterAddr::MyCounter {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    use StarcoinFramework::Signer;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct Counter has key {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        value: u64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public fun init(account: &amp;signer) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        move_to(account, Counter { value: 0 });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    public fun incr(account: &amp;signer) {</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        let counter = borrow_global_mut&lt;Counter&gt;(Signer::address_of(account));</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        counter.value = counter.value + 1</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>注意第3行我们引用了一个依赖 —— <a href="https://github.com/starcoinorg/starcoin-framework" target="_blank" rel="noopener noreferrer">StarcoinFramwork</a> 可以认为是 Starcoin 的 Stdlib 标准库。
我们需要使用库中的 <code>Signer::address_of(&amp;signer)</code> 方法来提取 <code>signer</code> 的地址。</p><p>为了添加依赖到项目中，修改 <em>Move.toml</em> 文件</p><div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">my-counter/Move.toml</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[package]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">name = &quot;my-counter&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">version = &quot;0.0.1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[addresses]</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">StarcoinFramework = &quot;0x1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MyCounterAddr = &quot;0xcada49d6a37864931afb639203501695&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">[dependencies]</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">StarcoinFramework = {git = &quot;https://github.com/starcoinorg/starcoin-framework.git&quot;, rev=&quot;2ee2378d0d6eaa4ebc1ac6d3e33c4aee11bc2fe4&quot;}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>由于 StarcoinFramework 源码可能会更新，导致使用这个例子中的StarcoinFramework rev(<code>2ee2378d0d6eaa4ebc1ac6d3e33c4aee11bc2fe4</code>) 在编译或者测试过程中失败或产生警告，如果遇到这种情况可以尝试使用最新的StarcoinFramework rev 版本。</p><p>第14行有个新方法 <code>borrow_global_mut</code>，和前文的 <code>move_to</code> 一样，都是操作账户地址的存储空间上资源的内置方法。</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>加油站 —— 资源的操作方法</div><div class="admonitionContent_S0QG"><ol><li><code>move_to&lt;T&gt;(&amp;signer, T)</code>：发布、添加类型为 <code>T</code> 的资源到 <code>signer</code> 的地址下。</li><li><code>move_from&lt;T&gt;(address): T</code>：从地址下删除类型为 <code>T</code> 的资源并返回这个资源。</li><li><code>borrow_global&lt;T&gt;(address): &amp;T</code>：返回地址下类型为 <code>T</code> 的资源的<em>不可变引用（immutable reference）</em>。</li><li><code>borrow_global_mut&lt;T&gt;(address): &amp;mut T</code>：返回地址下类型为 <code>T</code> 的资源的<em>可变引用（mutable reference）</em>。</li><li><code>exists&lt;T&gt;(address): bool</code>：判断地址下是否有类型为 <code>T</code> 的资源。</li></ol><p>要使用这些方法，资源 <code>T</code> 必须定义在当前模块。
<strong>这确保了资源只能被定义资源的模块所提供的 API 方法来操作</strong>。
参数 <code>address</code> 和 <code>signer</code> 代表了类型为 <code>T</code> 的资源存储的地址。</p></div></div><p>然后我们试着编译一下：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ mpm package build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CACHED StarcoinFramework</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BUILDING my-counter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">error[E04020]: missing acquires annotation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ┌─ ./sources/MyCounter.move:14:20</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">14 │         let counter = borrow_global_mut&lt;Counter&gt;(Signer::address_of(account));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │                       │                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │                       │                 The call acquires &#x27;MyCounterAddr::MyCounter::Counter&#x27;, but the &#x27;acquires&#x27; list for the current function does not contain this type. It must be present in the calling context&#x27;s acquires list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   │                       Invalid call to borrow_global_mut.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>哦！又出错了。
报错信息提示了我们第14行调用方法获取 <code>Counter</code> 结构时，类型（Counter 结构）必须出现在调用上下文的 <code>acquires</code> 列表中，而当前函数的 <code>acquires</code> 列表没有包含这个类型。</p><p>这里我们引入 <em>acquire</em> 的概念。</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>概念</div><div class="admonitionContent_S0QG"><p>当一个函数用 <code>move_from()</code>、<code>borrow_global()</code>、<code>borrow_global_mut()</code> 访问资源时，函数必须要显示声明需要“<strong>获取</strong>”哪种资源。
这会被 Move 的类型系统确保对资源的引用是安全的、不存在悬空引用。</p></div></div><p>修改后的代码如下：</p><div class="language-move codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">my-counter/sources/MyCounter.move</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-move codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">module MyCounterAddr::MyCounter {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use StarcoinFramework::Signer;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct Counter has key {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        value: u64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public fun init(account: &amp;signer) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        move_to(account, Counter { value: 0 });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    public fun incr(account: &amp;signer) acquires Counter {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let counter = borrow_global_mut&lt;Counter&gt;(Signer::address_of(account));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        counter.value = counter.value + 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>现在可以编译通过了。</p><p>下面我们编写可以通过控制台直接调用执行的函数。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="编写可调用的-script-function">编写可调用的 script function<a class="hash-link" href="#编写可调用的-script-function" title="标题的直接链接">​</a></h3><p>前面编写的 <code>public fun init</code> 和 <code>public fun incr</code> 函数是不能直接在控制台中调用执行的。需要使用<em>入口方法（entry function）</em>来调用。</p><p>目前在 Move 中，入口方法是通过 <code>script function</code> 来实现的，写作 <code>public(script) fun</code>。</p><p>这里引入了函数<em>可见性（visibility）</em>的概念，不同的可见性决定了函数可以从何处被调用。（下面的概念 <code>tip</code> 可以先跳过）</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>概念——函数可见性</div><div class="admonitionContent_S0QG"><table><thead><tr><th>可见性</th><th>写做</th><th>说明</th></tr></thead><tbody><tr><td>internal</td><td>fun</td><td>也可以叫 private，只能在同一个模块内调用</td></tr><tr><td>public</td><td>public fun</td><td>可以被任一模块内的函数调用</td></tr><tr><td><strong>public entry</strong></td><td>public entry fun</td><td>entry function 是模块中的入口方法，可以<strong>通过控制台发起一个交易来调用</strong>，就像本地执行脚本一样（不过代码已经被存在了链上的模块地址下）。</td></tr><tr><td>public friend</td><td>public(friend) fun</td><td>可以被同一模块内调用，可以被加入到 <code>friend list</code> 的可信任模块调用</td></tr><tr><td>:::</td><td></td><td></td></tr></tbody></table><p>下面，我们编写对应 <code>init</code> 和 <code>incr</code> 函数的 <em>script function</em>。</p><div class="language-move codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">my-counter/sources/MyCounter.move</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-move codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">module MyCounterAddr::MyCounter {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use StarcoinFramework::Signer;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct Counter has key, store {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        value: u64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public fun init(account: &amp;signer) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        move_to(account, Counter { value: 0 });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public fun incr(account: &amp;signer) acquires Counter {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let counter = borrow_global_mut&lt;Counter&gt;(Signer::address_of(account));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        counter.value = counter.value + 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    public(script) fun init_counter(account: signer) {</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        Self::init(&amp;account);</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    public(script) fun incr_counter(account: signer) acquires Counter {</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        Self::incr(&amp;account);</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>唯一需要说明的就是 <code>Self</code> 指代当前模块。</p><p>现在，我们将模块发布到链上，并尝试调用。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="发布到链上并调用">发布到链上并调用<a class="hash-link" href="#发布到链上并调用" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="发布到链上">发布到链上<a class="hash-link" href="#发布到链上" title="标题的直接链接">​</a></h3><p>运行 <code>mpm release</code> 命令：</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ mpm release</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Packaging Modules:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         0xcada49d6a37864931afb639203501695::MyCounter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Release done: release/my-counter.v0.0.1.blob, package hash: 0x31b36a1cd0fd13e84034a02e9972f68f1c9b1cde1c9dfbe7ac69f32f6fc6dafa</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>它将打包编译模块，获得二进制包。</p><p>前文中我们准备了地址为 <code>0xcada49d6a37864931afb639203501695</code> 的账户，如果没有余额，可以通过 <code>dev get-coin</code> 命令获取一些测试币。
现在将编译好的模块部署到这个账户地址下。</p><div class="language-starcoin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">starcoin控制台</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-starcoin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">starcoin% account unlock 0xcada49d6a37864931afb639203501695 -p &lt;MY-PASSWORD&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">starcoin% dev deploy /path/to/my-counter/release/my-counter.v0.0.1.blob -s 0xcada49d6a37864931afb639203501695 -b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">txn 0xf60662ba0ac3373c28f827a0ac9d9db6667c3921056905356aa5414b3bf3df09 submitted.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;ok&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;dry_run_output&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;events&quot;: [],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;explained_status&quot;: &quot;Executed&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;gas_used&quot;: &quot;7800&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;status&quot;: &quot;Executed&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;write_set&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;access_path&quot;: &quot;0x00000000000000000000000000000001/1/0x00000000000000000000000000000001::TransactionFee::TransactionFee&lt;0x00000000000000000000000000000001::STC::STC&gt;&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;action&quot;: &quot;Value&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;value&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;Resource&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              &quot;json&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;fee&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  &quot;value&quot;: 292331</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              &quot;raw&quot;: &quot;0xeb750400000000000000000000000000&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>-s</code> 即 <code>--sender</code> 是发送者，<code>-b</code> 即 <code>--blocking</code>，阻塞等待命令执行完成。</p><p>第5行的 <code>txn 0xf60662... submitted</code> 表示计数器的智能合约已经成功部署到发布者的地址下，这属于一个链上交易，链已经把这个交易状态记录下来了。</p><p>此时我们可以查看代码在链上的存储，</p><div class="language-starcoin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">starcoin控制台</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-starcoin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">starcoin% state list code 0xcada49d6a37864931afb639203501695</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;ok&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;codes&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;MyCounter&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;abi&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;module_name&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;address&quot;: &quot;0xcada49d6a37864931afb639203501695&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;name&quot;: &quot;MyCounter&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>可以看到 <code>0xcada49d6a37864931afb639203501695</code> 地址下只有 <code>MyCounter</code> 这一个合约代码。</p></div></div><p><code>state</code> 命令是用来查看账户地址下的数据的。可以在控制台中输入 <code>state --help</code> 查看更多帮助。
:::</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="调用-init_counter-初始化资源">调用 init_counter 初始化资源<a class="hash-link" href="#调用-init_counter-初始化资源" title="标题的直接链接">​</a></h3><p>使用 <code>account execute-function</code> 命令来执行一个 script function。现在我们调用 <code>init_counter</code> 方法，将 <code>Counter</code> 资源初始化到调用者的地址下。</p><div class="language-starcoin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">starcoin控制台</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-starcoin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">starcoin% account execute-function --function 0xcada49d6a37864931afb639203501695::MyCounter::init_counter -s 0xcada49d6a37864931afb639203501695 -b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">txn 0x032c0eda779157e0ef3949338c3b3e4e6528c7720776d02c2cb0ddd64804f1c2 submitted.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;ok&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;dry_run_output&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;events&quot;: [],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;explained_status&quot;: &quot;Executed&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;gas_used&quot;: &quot;11667&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;status&quot;: &quot;Executed&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;write_set&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>init_counter</code> 函数中，我们初始化了一个 <em>Counter 对象（资源）</em>，然后 <code>move_to</code> 到了调用者地址下。
让我们看看这个资源是否存在。使用 <code>state list resource &lt;ADDRESS&gt;</code> 命令查看给定地址下的资源列表。</p><div class="language-starcoin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">starcoin控制台</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-starcoin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">starcoin% state list resource 0xcada49d6a37864931afb639203501695</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...（输出很多，我们观察最后一部分）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;0xcada49d6a37864931afb639203501695::MyCounter::Counter&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;json&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;value&quot;: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;raw&quot;: &quot;0x0000000000000000&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>可以看到地址 <code>0xcada49d6a37864931afb639203501695</code> 下有了 <code>0xcada49d6a37864931afb639203501695::MyCounter::Counter</code> 这个类型的资源，内容是 <code>&quot;value&quot;: 0</code>。</p><p>可能有小伙伴会疑惑为什么 <code>Counter</code> 资源类型名要写这么长，下面先帮大家回忆一下 FQN 的概念。</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>概念——完整名称 FQN</div><div class="admonitionContent_S0QG"><p><em>Fully Qualified Name(FQN)</em> 是一种计算机术语，是在一个调用上下文中，对一个资源（对象、函数、域名、文件）名称的无歧义定义。举例来说：</p><ol><li>Linux 的绝对路径名 <code>/path/to/file</code> 就是 <em>fully qualified file name</em>，相对的 <code>./to/file</code> 是一个相对路径地址。</li><li>域名系统中，<code>google.com.</code> 是一个 <em>fully qualified domain name</em>，注意最后的 <code>.</code>。意味着这个域名不要继续被递归解析。</li></ol><p>那么对应到 Move 语言中，资源类型是发布到某个地址下的，属于这个地址。
地址 <code>0x001</code> 可以创建一个 <code>Counter</code> 类型的资源，地址 <code>0x002</code> 也可以创建一个 <code>Counter</code> 类型的资源，要区分两个 <code>Counter</code>，就需要带上地址和模块名。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;address&gt;::&lt;module_identifier&gt;::&lt;structure&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="调用-incr_counter-递增计数器">调用 incr_counter 递增计数器<a class="hash-link" href="#调用-incr_counter-递增计数器" title="标题的直接链接">​</a></h3><p>下面调用另一个函数 <code>incr_counter</code> 尝试对计数器加一。</p><div class="language-starcoin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">starcoin控制台</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-starcoin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">starcoin% account execute-function --function 0xcada49d6a37864931afb639203501695::MyCounter::incr_counter -s 0xcada49d6a37864931afb639203501695 -b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">txn 0x032c0eda779157e0ef3949338c3b3e4e6528c7720776d02c2cb0ddd64804f1c2 submitted.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>再次查看资源，有了前面 FQN 的概念，这次我们换一个命令，用 <code>state get resource &lt;ADDRESS&gt; [RESOURCE_TYPE]</code> 查看 <code>ADDRESS</code> 下特定的资源类型。</p><div class="language-starcoin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">starcoin控制台</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-starcoin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">starcoin% state get resource 0xcada49d6a37864931afb639203501695 0xcada49d6a37864931afb639203501695::MyCounter::Counter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;ok&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;json&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;value&quot;: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;raw&quot;: &quot;0x0100000000000000&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>可以看到计数器的值 <code>value</code> 变为了 <code>1</code>。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="另一个账号调用">另一个账号调用<a class="hash-link" href="#另一个账号调用" title="标题的直接链接">​</a></h3><p>前面的例子中，我们用了同一个地址 <code>0xcada49d6a37864931afb639203501695</code> 来发布模块、创建 Counter 资源类型（dev deploy），以及调用函数添加计数器（account execute-function）。</p><p>我们再换一个账号来初始化计数器和自增计数器。假设本地的一个账号为 <code>0x012ABC</code>。</p><div class="language-starcoin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">starcoin控制台</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-starcoin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">starcoin% account execute-function -s 0x012ABC  --function 0xb19b07b76f00a8df445368a91c0547cc::MyCounter::init_counter -b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">starcoin% state get resource 0x012ABC 0xcada49d6a37864931afb639203501695::MyCounter::Counter</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>读者可以自行观察 <code>0x012ABC</code> 下资源的变化。</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>历史 —— script 和 script function</div><div class="admonitionContent_S0QG"><p>为了防止大家在别处看的教程中有 <code>script</code> 出现而搞迷惑，这里简单说一下历史由来。<em>这部分内容可以跳过</em>。</p><p>我们用 <em>Python</em> 的 <code>pip</code> 或者 <em>Node.js</em> 的 <code>npm</code> 来辅助理解。</p><p>在 <code>pip</code> 和 <code>npm</code> 这样的中心化包管理托管平台出现之前，我们想安装一个包，需要 <code>setup.py install /path/to/package</code>。
这样子当然不便于包的分发传播与索引。
后来有了 <code>pip</code> 我们是怎么做的呢，包作者先将自己的包打包上传到 <code>pip</code> 仓库，<code>pip</code> 会存储包并建立索引。
普通用户只需要 <code>pip install package_name</code> 即可。
<code>pip</code> 工具会根据你提供的 <code>package_name</code> 下载源码，然后执行安装。这两种安装包的方式其实是一样的。</p><p>现在对应到 Move 中。在 <code>script function</code> 出现之前是只有 <code>script</code> 的，<code>script</code> 写在与 <code>sources</code> 目录平级的 <code>scripts</code> 目录下。</p><p><code>script</code> 就像是本地的 Python 包，<code>script</code> 可以被编译为字节码，要调用 <code>script</code> 时，需要创建一个交易，<code>payload</code> 中带上编译好的字节码，<code>script</code> 就可以被节点上的 Move 虚拟机执行了。对应在 Starcoin 控制台中是：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">starcoin% account execute-script &lt;/path/to/mv_file&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>script function</code> 作为 <code>script</code> 的替代，<a href="https://github.com/move-language/move/commit/e0a3acb7d5e3f5dbc07ee76b47dd05229584d4d0" target="_blank" rel="noopener noreferrer">被添加到了 Move 语言中</a>。
类比于保存在 <code>pip</code> 仓库中的软件包。<code>script function</code> 会在模块中一起发布到一个地址下（就像包作者把软件包发布在 <code>pip</code> 中一样）。
此时，要调用 <code>script</code>，需要创建一个交易，<code>payload</code> 中指向已经发布的代码的地址即可。对应到 Starcoin 控制台中是:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">starcoin% account execute-function --function  &lt;0x地址&gt;::&lt;模块&gt;::&lt;函数&gt; --arg xxx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>当然，Move 也是一门正在演进的语言，<code>public(script) fun</code> <a href="https://github.com/move-language/move/pull/186" target="_blank" rel="noopener noreferrer">正在被 <code>public entry</code> 取代</a>，让我们拭目以待。</p><p>总结一下：</p><ol><li><code>script</code> 可能会被废弃，推荐用 <code>script function</code> 做入口方法。</li><li>下个版本的 Move 会用 <code>public entry fun</code> 替代 <code>public(script) fun</code></li></ol></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="何去何从">何去何从<a class="hash-link" href="#何去何从" title="标题的直接链接">​</a></h2><p>恭喜你，你已经完成了一个简单合约的编写、部署和调用的全流程。</p><p>完整的代码仓库在<a href="https://github.com/starcoinorg/starcoin-cookbook/tree/main/examples/my-counter" target="_blank" rel="noopener noreferrer">这里</a>。</p><p>接下来，</p><ul><li>你可以通过 <a href="/zh/docs/move/move-language/">Move 语言</a>来系统地学习 Move 语言</li><li>查看<!-- -->[更多 Move 例子]</li><li>了解<a href="/zh/docs/move/move-test/move-unit-test">如何 Debug/测试 Move module</a></li><li>了解 <a href="/zh/docs/move/starcoin-framework/">Starcoin Move Framework</a></li><li>可以通过 <!-- -->[Move 高级开发]<!-- -->学习高级 Move。</li><li>了解 <a href="/zh/docs/move/move-prover/move-spec-language">Move 规范语言 和 Move Prover</a> 开发更安全的 Move 应用</li><li>探索 <a href="/zh/docs/move/move-package-manager">Move 包管理器</a>的更多功能</li></ul><p>或者，你可以直接进入 Dapp 的世界，</p><ul><li><a href="/zh/docs/web3/">Web3 和 DApp 开发</a></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/starcoinorg/starcoin-cookbook/edit/main/i18n/zh/docusaurus-plugin-content-docs/current/03-move/02-quick-start.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/zh/docs/move/prepare-move-env"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">设置 Move 开发环境</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/zh/docs/move/move-language/"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Move 语言</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#mpm-命令行工具以及项目结构" class="table-of-contents__link toc-highlight">mpm 命令行工具以及项目结构</a></li><li><a href="#创建-mycounter-模块" class="table-of-contents__link toc-highlight">创建 MyCounter 模块</a><ul><li><a href="#第一版代码" class="table-of-contents__link toc-highlight">第一版代码</a></li><li><a href="#初始化方法-init" class="table-of-contents__link toc-highlight">初始化方法 init</a></li><li><a href="#计数器加一的方法-incr" class="table-of-contents__link toc-highlight">计数器加一的方法 incr</a></li><li><a href="#编写可调用的-script-function" class="table-of-contents__link toc-highlight">编写可调用的 script function</a></li><li><a href="#调用-init_counter-初始化资源" class="table-of-contents__link toc-highlight">调用 init_counter 初始化资源</a></li><li><a href="#调用-incr_counter-递增计数器" class="table-of-contents__link toc-highlight">调用 incr_counter 递增计数器</a></li><li><a href="#另一个账号调用" class="table-of-contents__link toc-highlight">另一个账号调用</a></li></ul></li><li><a href="#何去何从" class="table-of-contents__link toc-highlight">何去何从</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/zh/docs/intro">Documents</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/starcoin" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discor.gg/starcoin" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://t.me/starcoin_contributor" target="_blank" rel="noopener noreferrer" class="footer__link-item">Developer Telegram group<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/StarcoinSTC" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/starcoinorg/starcoin" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Starcoin, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/zh/assets/js/runtime~main.dce544f6.js"></script>
<script src="/zh/assets/js/main.4328e06e.js"></script>
</body>
</html>